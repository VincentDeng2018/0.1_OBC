###############################################################################
#
# IAR ANSI C/C++ Compiler V7.80.4.12462/W32 for ARM       19/Nov/2018  00:45:11
# Copyright 1999-2017 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Libraries\STM32F10x_StdPeriph_Driver\src\stm32f10x_flash.c
#    Command line =  
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Libraries\STM32F10x_StdPeriph_Driver\src\stm32f10x_flash.c
#        -D USE_STDPERIPH_DRIVER -D STM32F10X_CL -D USE_STM3210C_EVAL -D
#        USE_USB_OTG_FS -lcN
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\STM3210C-EVAL_USBD-FS\List
#        -o
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\STM3210C-EVAL_USBD-FS\Obj
#        --debug --endian=little --cpu=Cortex-M3 -e --fpu=None --dlib_config
#        "E:\Program Files (x86)\IAR Systems\Embedded Workbench
#        7.5\arm\INC\c\DLib_Config_Full.h" -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\inc\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Libraries\CMSIS\Device\ST\STM32F10x\Include\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Libraries\STM32F10x_StdPeriph_Driver\inc\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Libraries\STM32_USB_OTG_Driver\inc\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Libraries\STM32_USB_Device_Library\Core\inc\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Libraries\STM32_USB_Device_Library\Class\cdc\inc\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Utilities\STM32_EVAL\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Utilities\STM32_EVAL\Common\
#        -I
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\..\..\..\..\Utilities\STM32_EVAL\STM3210C_EVAL\
#        -Ohz --use_c++_inline -I "E:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.5\arm\CMSIS\Include\"
#    Locale       =  Chinese (Simplified)_China.936
#    List file    =  
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\STM3210C-EVAL_USBD-FS\List\stm32f10x_flash.lst
#    Object file  =  
#        E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Project\USB_Device_Examples\VCP\EWARM\STM3210C-EVAL_USBD-FS\Obj\stm32f10x_flash.o
#
###############################################################################

E:\DYH\01_EmbeddedSoftware\Github\0.1_OBC\Reference\en.stm32_f105-07_f2_f4_usb-host-device_lib\Libraries\STM32F10x_StdPeriph_Driver\src\stm32f10x_flash.c
      1          /**
      2            ******************************************************************************
      3            * @file    stm32f10x_flash.c
      4            * @author  MCD Application Team
      5            * @version V3.6.1
      6            * @date    05-March-2012
      7            * @brief   This file provides all the FLASH firmware functions.
      8            ******************************************************************************
      9            * @attention
     10            *
     11            * <h2><center>&copy; COPYRIGHT 2012 STMicroelectronics</center></h2>
     12            *
     13            * Licensed under MCD-ST Liberty SW License Agreement V2, (the "License");
     14            * You may not use this file except in compliance with the License.
     15            * You may obtain a copy of the License at:
     16            *
     17            *        http://www.st.com/software_license_agreement_liberty_v2
     18            *
     19            * Unless required by applicable law or agreed to in writing, software 
     20            * distributed under the License is distributed on an "AS IS" BASIS, 
     21            * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     22            * See the License for the specific language governing permissions and
     23            * limitations under the License.
     24            *
     25            ******************************************************************************
     26            */
     27          
     28          /* Includes ------------------------------------------------------------------*/
     29          #include "stm32f10x_flash.h"
     30          
     31          /** @addtogroup STM32F10x_StdPeriph_Driver
     32            * @{
     33            */
     34          
     35          /** @defgroup FLASH 
     36            * @brief FLASH driver modules
     37            * @{
     38            */ 
     39          
     40          /** @defgroup FLASH_Private_TypesDefinitions
     41            * @{
     42            */
     43          
     44          /**
     45            * @}
     46            */ 
     47          
     48          /** @defgroup FLASH_Private_Defines
     49            * @{
     50            */ 
     51          
     52          /* Flash Access Control Register bits */
     53          #define ACR_LATENCY_Mask         ((uint32_t)0x00000038)
     54          #define ACR_HLFCYA_Mask          ((uint32_t)0xFFFFFFF7)
     55          #define ACR_PRFTBE_Mask          ((uint32_t)0xFFFFFFEF)
     56          
     57          /* Flash Access Control Register bits */
     58          #define ACR_PRFTBS_Mask          ((uint32_t)0x00000020) 
     59          
     60          /* Flash Control Register bits */
     61          #define CR_PG_Set                ((uint32_t)0x00000001)
     62          #define CR_PG_Reset              ((uint32_t)0x00001FFE) 
     63          #define CR_PER_Set               ((uint32_t)0x00000002)
     64          #define CR_PER_Reset             ((uint32_t)0x00001FFD)
     65          #define CR_MER_Set               ((uint32_t)0x00000004)
     66          #define CR_MER_Reset             ((uint32_t)0x00001FFB)
     67          #define CR_OPTPG_Set             ((uint32_t)0x00000010)
     68          #define CR_OPTPG_Reset           ((uint32_t)0x00001FEF)
     69          #define CR_OPTER_Set             ((uint32_t)0x00000020)
     70          #define CR_OPTER_Reset           ((uint32_t)0x00001FDF)
     71          #define CR_STRT_Set              ((uint32_t)0x00000040)
     72          #define CR_LOCK_Set              ((uint32_t)0x00000080)
     73          
     74          /* FLASH Mask */
     75          #define RDPRT_Mask               ((uint32_t)0x00000002)
     76          #define WRP0_Mask                ((uint32_t)0x000000FF)
     77          #define WRP1_Mask                ((uint32_t)0x0000FF00)
     78          #define WRP2_Mask                ((uint32_t)0x00FF0000)
     79          #define WRP3_Mask                ((uint32_t)0xFF000000)
     80          #define OB_USER_BFB2             ((uint16_t)0x0008)
     81          
     82          /* FLASH BANK address */
     83          #define FLASH_BANK1_END_ADDRESS   ((uint32_t)0x807FFFF)
     84          
     85          /* Delay definition */   
     86          #define EraseTimeout          ((uint32_t)0x000B0000)
     87          #define ProgramTimeout        ((uint32_t)0x00002000)
     88          /**
     89            * @}
     90            */ 
     91          
     92          /** @defgroup FLASH_Private_Macros
     93            * @{
     94            */
     95          
     96          /**
     97            * @}
     98            */ 
     99          
    100          /** @defgroup FLASH_Private_Variables
    101            * @{
    102            */
    103          
    104          /**
    105            * @}
    106            */ 
    107          
    108          /** @defgroup FLASH_Private_FunctionPrototypes
    109            * @{
    110            */
    111            
    112          /**
    113            * @}
    114            */
    115          
    116          /** @defgroup FLASH_Private_Functions
    117            * @{
    118            */
    119          
    120          /**
    121          @code  
    122           
    123           This driver provides functions to configure and program the Flash memory of all STM32F10x devices,
    124           including the latest STM32F10x_XL density devices. 
    125          
    126           STM32F10x_XL devices feature up to 1 Mbyte with dual bank architecture for read-while-write (RWW) capability:
    127              - bank1: fixed size of 512 Kbytes (256 pages of 2Kbytes each)
    128              - bank2: up to 512 Kbytes (up to 256 pages of 2Kbytes each)
    129           While other STM32F10x devices features only one bank with memory up to 512 Kbytes.
    130          
    131           In version V3.3.0, some functions were updated and new ones were added to support
    132           STM32F10x_XL devices. Thus some functions manages all devices, while other are 
    133           dedicated for XL devices only.
    134           
    135           The table below presents the list of available functions depending on the used STM32F10x devices.  
    136                
    137             ***************************************************
    138             * Legacy functions used for all STM32F10x devices *
    139             ***************************************************
    140             +----------------------------------------------------------------------------------------------------------------------------------+
    141             |       Functions prototypes         |STM32F10x_XL|Other STM32F10x|    Comments                                                    |
    142             |                                    |   devices  |  devices      |                                                                |
    143             |----------------------------------------------------------------------------------------------------------------------------------|
    144             |FLASH_SetLatency                    |    Yes     |      Yes      | No change                                                      |
    145             |----------------------------------------------------------------------------------------------------------------------------------|
    146             |FLASH_HalfCycleAccessCmd            |    Yes     |      Yes      | No change                                                      |
    147             |----------------------------------------------------------------------------------------------------------------------------------|
    148             |FLASH_PrefetchBufferCmd             |    Yes     |      Yes      | No change                                                      |
    149             |----------------------------------------------------------------------------------------------------------------------------------|
    150             |FLASH_Unlock                        |    Yes     |      Yes      | - For STM32F10X_XL devices: unlock Bank1 and Bank2.            |
    151             |                                    |            |               | - For other devices: unlock Bank1 and it is equivalent         |
    152             |                                    |            |               |   to FLASH_UnlockBank1 function.                               |
    153             |----------------------------------------------------------------------------------------------------------------------------------|
    154             |FLASH_Lock                          |    Yes     |      Yes      | - For STM32F10X_XL devices: lock Bank1 and Bank2.              |
    155             |                                    |            |               | - For other devices: lock Bank1 and it is equivalent           |
    156             |                                    |            |               |   to FLASH_LockBank1 function.                                 |
    157             |----------------------------------------------------------------------------------------------------------------------------------|
    158             |FLASH_ErasePage                     |    Yes     |      Yes      | - For STM32F10x_XL devices: erase a page in Bank1 and Bank2    |
    159             |                                    |            |               | - For other devices: erase a page in Bank1                     |
    160             |----------------------------------------------------------------------------------------------------------------------------------|
    161             |FLASH_EraseAllPages                 |    Yes     |      Yes      | - For STM32F10x_XL devices: erase all pages in Bank1 and Bank2 |
    162             |                                    |            |               | - For other devices: erase all pages in Bank1                  |
    163             |----------------------------------------------------------------------------------------------------------------------------------|
    164             |FLASH_EraseOptionBytes              |    Yes     |      Yes      | No change                                                      |
    165             |----------------------------------------------------------------------------------------------------------------------------------|
    166             |FLASH_ProgramWord                   |    Yes     |      Yes      | Updated to program up to 1MByte (depending on the used device) |
    167             |----------------------------------------------------------------------------------------------------------------------------------|
    168             |FLASH_ProgramHalfWord               |    Yes     |      Yes      | Updated to program up to 1MByte (depending on the used device) |
    169             |----------------------------------------------------------------------------------------------------------------------------------|
    170             |FLASH_ProgramOptionByteData         |    Yes     |      Yes      | No change                                                      |
    171             |----------------------------------------------------------------------------------------------------------------------------------|
    172             |FLASH_EnableWriteProtection         |    Yes     |      Yes      | No change                                                      |
    173             |----------------------------------------------------------------------------------------------------------------------------------|
    174             |FLASH_ReadOutProtection             |    Yes     |      Yes      | No change                                                      |
    175             |----------------------------------------------------------------------------------------------------------------------------------|
    176             |FLASH_UserOptionByteConfig          |    Yes     |      Yes      | No change                                                      |
    177             |----------------------------------------------------------------------------------------------------------------------------------|
    178             |FLASH_GetUserOptionByte             |    Yes     |      Yes      | No change                                                      |
    179             |----------------------------------------------------------------------------------------------------------------------------------|
    180             |FLASH_GetWriteProtectionOptionByte  |    Yes     |      Yes      | No change                                                      |
    181             |----------------------------------------------------------------------------------------------------------------------------------|
    182             |FLASH_GetReadOutProtectionStatus    |    Yes     |      Yes      | No change                                                      |
    183             |----------------------------------------------------------------------------------------------------------------------------------|
    184             |FLASH_GetPrefetchBufferStatus       |    Yes     |      Yes      | No change                                                      |
    185             |----------------------------------------------------------------------------------------------------------------------------------|
    186             |FLASH_ITConfig                      |    Yes     |      Yes      | - For STM32F10x_XL devices: enable Bank1 and Bank2's interrupts|
    187             |                                    |            |               | - For other devices: enable Bank1's interrupts                 |
    188             |----------------------------------------------------------------------------------------------------------------------------------|
    189             |FLASH_GetFlagStatus                 |    Yes     |      Yes      | - For STM32F10x_XL devices: return Bank1 and Bank2's flag status|
    190             |                                    |            |               | - For other devices: return Bank1's flag status                |
    191             |----------------------------------------------------------------------------------------------------------------------------------|
    192             |FLASH_ClearFlag                     |    Yes     |      Yes      | - For STM32F10x_XL devices: clear Bank1 and Bank2's flag       |
    193             |                                    |            |               | - For other devices: clear Bank1's flag                        |
    194             |----------------------------------------------------------------------------------------------------------------------------------|
    195             |FLASH_GetStatus                     |    Yes     |      Yes      | - Return the status of Bank1 (for all devices)                 |
    196             |                                    |            |               |   equivalent to FLASH_GetBank1Status function                  |
    197             |----------------------------------------------------------------------------------------------------------------------------------|
    198             |FLASH_WaitForLastOperation          |    Yes     |      Yes      | - Wait for Bank1 last operation (for all devices)              |
    199             |                                    |            |               |   equivalent to: FLASH_WaitForLastBank1Operation function      |
    200             +----------------------------------------------------------------------------------------------------------------------------------+
    201          
    202             ************************************************************************************************************************
    203             * New functions used for all STM32F10x devices to manage Bank1:                                                        *
    204             *   - These functions are mainly useful for STM32F10x_XL density devices, to have separate control for Bank1 and bank2 *
    205             *   - For other devices, these functions are optional (covered by functions listed above)                              *
    206             ************************************************************************************************************************
    207             +----------------------------------------------------------------------------------------------------------------------------------+
    208             |       Functions prototypes         |STM32F10x_XL|Other STM32F10x|    Comments                                                    |
    209             |                                    |   devices  |  devices      |                                                                |
    210             |----------------------------------------------------------------------------------------------------------------------------------|
    211             | FLASH_UnlockBank1                  |    Yes     |      Yes      | - Unlock Bank1                                                 |
    212             |----------------------------------------------------------------------------------------------------------------------------------|
    213             |FLASH_LockBank1                     |    Yes     |      Yes      | - Lock Bank1                                                   |
    214             |----------------------------------------------------------------------------------------------------------------------------------|
    215             | FLASH_EraseAllBank1Pages           |    Yes     |      Yes      | - Erase all pages in Bank1                                     |
    216             |----------------------------------------------------------------------------------------------------------------------------------|
    217             | FLASH_GetBank1Status               |    Yes     |      Yes      | - Return the status of Bank1                                   |
    218             |----------------------------------------------------------------------------------------------------------------------------------|
    219             | FLASH_WaitForLastBank1Operation    |    Yes     |      Yes      | - Wait for Bank1 last operation                                |
    220             +----------------------------------------------------------------------------------------------------------------------------------+
    221          
    222             *****************************************************************************
    223             * New Functions used only with STM32F10x_XL density devices to manage Bank2 *
    224             *****************************************************************************
    225             +----------------------------------------------------------------------------------------------------------------------------------+
    226             |       Functions prototypes         |STM32F10x_XL|Other STM32F10x|    Comments                                                    |
    227             |                                    |   devices  |  devices      |                                                                |
    228             |----------------------------------------------------------------------------------------------------------------------------------|
    229             | FLASH_UnlockBank2                  |    Yes     |      No       | - Unlock Bank2                                                 |
    230             |----------------------------------------------------------------------------------------------------------------------------------|
    231             |FLASH_LockBank2                     |    Yes     |      No       | - Lock Bank2                                                   |
    232             |----------------------------------------------------------------------------------------------------------------------------------|
    233             | FLASH_EraseAllBank2Pages           |    Yes     |      No       | - Erase all pages in Bank2                                     |
    234             |----------------------------------------------------------------------------------------------------------------------------------|
    235             | FLASH_GetBank2Status               |    Yes     |      No       | - Return the status of Bank2                                   |
    236             |----------------------------------------------------------------------------------------------------------------------------------|
    237             | FLASH_WaitForLastBank2Operation    |    Yes     |      No       | - Wait for Bank2 last operation                                |
    238             |----------------------------------------------------------------------------------------------------------------------------------|
    239             | FLASH_BootConfig                   |    Yes     |      No       | - Configure to boot from Bank1 or Bank2                        |
    240             +----------------------------------------------------------------------------------------------------------------------------------+
    241          @endcode
    242          */
    243          
    244          
    245          /**
    246            * @brief  Sets the code latency value.
    247            * @note   This function can be used for all STM32F10x devices.
    248            * @param  FLASH_Latency: specifies the FLASH Latency value.
    249            *   This parameter can be one of the following values:
    250            *     @arg FLASH_Latency_0: FLASH Zero Latency cycle
    251            *     @arg FLASH_Latency_1: FLASH One Latency cycle
    252            *     @arg FLASH_Latency_2: FLASH Two Latency cycles
    253            * @retval None
    254            */
    255          void FLASH_SetLatency(uint32_t FLASH_Latency)
    256          {
    257            uint32_t tmpreg = 0;
    258            
    259            /* Check the parameters */
    260            assert_param(IS_FLASH_LATENCY(FLASH_Latency));
    261            
    262            /* Read the ACR register */
    263            tmpreg = FLASH->ACR;  
    264            
    265            /* Sets the Latency value */
    266            tmpreg &= ACR_LATENCY_Mask;
    267            tmpreg |= FLASH_Latency;
    268            
    269            /* Write the ACR register */
    270            FLASH->ACR = tmpreg;
    271          }
    272          
    273          /**
    274            * @brief  Enables or disables the Half cycle flash access.
    275            * @note   This function can be used for all STM32F10x devices.
    276            * @param  FLASH_HalfCycleAccess: specifies the FLASH Half cycle Access mode.
    277            *   This parameter can be one of the following values:
    278            *     @arg FLASH_HalfCycleAccess_Enable: FLASH Half Cycle Enable
    279            *     @arg FLASH_HalfCycleAccess_Disable: FLASH Half Cycle Disable
    280            * @retval None
    281            */
    282          void FLASH_HalfCycleAccessCmd(uint32_t FLASH_HalfCycleAccess)
    283          {
    284            /* Check the parameters */
    285            assert_param(IS_FLASH_HALFCYCLEACCESS_STATE(FLASH_HalfCycleAccess));
    286            
    287            /* Enable or disable the Half cycle access */
    288            FLASH->ACR &= ACR_HLFCYA_Mask;
    289            FLASH->ACR |= FLASH_HalfCycleAccess;
    290          }
    291          
    292          /**
    293            * @brief  Enables or disables the Prefetch Buffer.
    294            * @note   This function can be used for all STM32F10x devices.
    295            * @param  FLASH_PrefetchBuffer: specifies the Prefetch buffer status.
    296            *   This parameter can be one of the following values:
    297            *     @arg FLASH_PrefetchBuffer_Enable: FLASH Prefetch Buffer Enable
    298            *     @arg FLASH_PrefetchBuffer_Disable: FLASH Prefetch Buffer Disable
    299            * @retval None
    300            */
    301          void FLASH_PrefetchBufferCmd(uint32_t FLASH_PrefetchBuffer)
    302          {
    303            /* Check the parameters */
    304            assert_param(IS_FLASH_PREFETCHBUFFER_STATE(FLASH_PrefetchBuffer));
    305            
    306            /* Enable or disable the Prefetch Buffer */
    307            FLASH->ACR &= ACR_PRFTBE_Mask;
    308            FLASH->ACR |= FLASH_PrefetchBuffer;
    309          }
    310          
    311          /**
    312            * @brief  Unlocks the FLASH Program Erase Controller.
    313            * @note   This function can be used for all STM32F10x devices.
    314            *         - For STM32F10X_XL devices this function unlocks Bank1 and Bank2.
    315            *         - For all other devices it unlocks Bank1 and it is equivalent 
    316            *           to FLASH_UnlockBank1 function.. 
    317            * @param  None
    318            * @retval None
    319            */
    320          void FLASH_Unlock(void)
    321          {
    322            /* Authorize the FPEC of Bank1 Access */
    323            FLASH->KEYR = FLASH_KEY1;
    324            FLASH->KEYR = FLASH_KEY2;
    325          
    326          #ifdef STM32F10X_XL
    327            /* Authorize the FPEC of Bank2 Access */
    328            FLASH->KEYR2 = FLASH_KEY1;
    329            FLASH->KEYR2 = FLASH_KEY2;
    330          #endif /* STM32F10X_XL */
    331          }
    332          /**
    333            * @brief  Unlocks the FLASH Bank1 Program Erase Controller.
    334            * @note   This function can be used for all STM32F10x devices.
    335            *         - For STM32F10X_XL devices this function unlocks Bank1.
    336            *         - For all other devices it unlocks Bank1 and it is 
    337            *           equivalent to FLASH_Unlock function.
    338            * @param  None
    339            * @retval None
    340            */
    341          void FLASH_UnlockBank1(void)
    342          {
    343            /* Authorize the FPEC of Bank1 Access */
    344            FLASH->KEYR = FLASH_KEY1;
    345            FLASH->KEYR = FLASH_KEY2;
    346          }
    347          
    348          #ifdef STM32F10X_XL
    349          /**
    350            * @brief  Unlocks the FLASH Bank2 Program Erase Controller.
    351            * @note   This function can be used only for STM32F10X_XL density devices.
    352            * @param  None
    353            * @retval None
    354            */
    355          void FLASH_UnlockBank2(void)
    356          {
    357            /* Authorize the FPEC of Bank2 Access */
    358            FLASH->KEYR2 = FLASH_KEY1;
    359            FLASH->KEYR2 = FLASH_KEY2;
    360          
    361          }
    362          #endif /* STM32F10X_XL */
    363          
    364          /**
    365            * @brief  Locks the FLASH Program Erase Controller.
    366            * @note   This function can be used for all STM32F10x devices.
    367            *         - For STM32F10X_XL devices this function Locks Bank1 and Bank2.
    368            *         - For all other devices it Locks Bank1 and it is equivalent 
    369            *           to FLASH_LockBank1 function.
    370            * @param  None
    371            * @retval None
    372            */
    373          void FLASH_Lock(void)
    374          {
    375            /* Set the Lock Bit to lock the FPEC and the CR of  Bank1 */
    376            FLASH->CR |= CR_LOCK_Set;
    377          
    378          #ifdef STM32F10X_XL
    379            /* Set the Lock Bit to lock the FPEC and the CR of  Bank2 */
    380            FLASH->CR2 |= CR_LOCK_Set;
    381          #endif /* STM32F10X_XL */
    382          }
    383          
    384          /**
    385            * @brief  Locks the FLASH Bank1 Program Erase Controller.
    386            * @note   this function can be used for all STM32F10x devices.
    387            *         - For STM32F10X_XL devices this function Locks Bank1.
    388            *         - For all other devices it Locks Bank1 and it is equivalent 
    389            *           to FLASH_Lock function.
    390            * @param  None
    391            * @retval None
    392            */
    393          void FLASH_LockBank1(void)
    394          {
    395            /* Set the Lock Bit to lock the FPEC and the CR of  Bank1 */
    396            FLASH->CR |= CR_LOCK_Set;
    397          }
    398          
    399          #ifdef STM32F10X_XL
    400          /**
    401            * @brief  Locks the FLASH Bank2 Program Erase Controller.
    402            * @note   This function can be used only for STM32F10X_XL density devices.
    403            * @param  None
    404            * @retval None
    405            */
    406          void FLASH_LockBank2(void)
    407          {
    408            /* Set the Lock Bit to lock the FPEC and the CR of  Bank2 */
    409            FLASH->CR2 |= CR_LOCK_Set;
    410          }
    411          #endif /* STM32F10X_XL */
    412          
    413          /**
    414            * @brief  Erases a specified FLASH page.
    415            * @note   This function can be used for all STM32F10x devices.
    416            * @param  Page_Address: The page address to be erased.
    417            * @retval FLASH Status: The returned value can be: FLASH_BUSY, FLASH_ERROR_PG,
    418            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
    419            */
    420          FLASH_Status FLASH_ErasePage(uint32_t Page_Address)
    421          {
    422            FLASH_Status status = FLASH_COMPLETE;
    423            /* Check the parameters */
    424            assert_param(IS_FLASH_ADDRESS(Page_Address));
    425          
    426          #ifdef STM32F10X_XL
    427            if(Page_Address < FLASH_BANK1_END_ADDRESS)  
    428            {
    429              /* Wait for last operation to be completed */
    430              status = FLASH_WaitForLastBank1Operation(EraseTimeout);
    431              if(status == FLASH_COMPLETE)
    432              { 
    433                /* if the previous operation is completed, proceed to erase the page */
    434                FLASH->CR|= CR_PER_Set;
    435                FLASH->AR = Page_Address; 
    436                FLASH->CR|= CR_STRT_Set;
    437              
    438                /* Wait for last operation to be completed */
    439                status = FLASH_WaitForLastBank1Operation(EraseTimeout);
    440          
    441                /* Disable the PER Bit */
    442                FLASH->CR &= CR_PER_Reset;
    443              }
    444            }
    445            else
    446            {
    447              /* Wait for last operation to be completed */
    448              status = FLASH_WaitForLastBank2Operation(EraseTimeout);
    449              if(status == FLASH_COMPLETE)
    450              { 
    451                /* if the previous operation is completed, proceed to erase the page */
    452                FLASH->CR2|= CR_PER_Set;
    453                FLASH->AR2 = Page_Address; 
    454                FLASH->CR2|= CR_STRT_Set;
    455              
    456                /* Wait for last operation to be completed */
    457                status = FLASH_WaitForLastBank2Operation(EraseTimeout);
    458                
    459                /* Disable the PER Bit */
    460                FLASH->CR2 &= CR_PER_Reset;
    461              }
    462            }
    463          #else
    464            /* Wait for last operation to be completed */
    465            status = FLASH_WaitForLastOperation(EraseTimeout);
    466            
    467            if(status == FLASH_COMPLETE)
    468            { 
    469              /* if the previous operation is completed, proceed to erase the page */
    470              FLASH->CR|= CR_PER_Set;
    471              FLASH->AR = Page_Address; 
    472              FLASH->CR|= CR_STRT_Set;
    473              
    474              /* Wait for last operation to be completed */
    475              status = FLASH_WaitForLastOperation(EraseTimeout);
    476              
    477              /* Disable the PER Bit */
    478              FLASH->CR &= CR_PER_Reset;
    479            }
    480          #endif /* STM32F10X_XL */
    481          
    482            /* Return the Erase Status */
    483            return status;
    484          }
    485          
    486          /**
    487            * @brief  Erases all FLASH pages.
    488            * @note   This function can be used for all STM32F10x devices.
    489            * @param  None
    490            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    491            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
    492            */
    493          FLASH_Status FLASH_EraseAllPages(void)
    494          {
    495            FLASH_Status status = FLASH_COMPLETE;
    496          
    497          #ifdef STM32F10X_XL
    498            /* Wait for last operation to be completed */
    499            status = FLASH_WaitForLastBank1Operation(EraseTimeout);
    500            
    501            if(status == FLASH_COMPLETE)
    502            {
    503              /* if the previous operation is completed, proceed to erase all pages */
    504               FLASH->CR |= CR_MER_Set;
    505               FLASH->CR |= CR_STRT_Set;
    506              
    507              /* Wait for last operation to be completed */
    508              status = FLASH_WaitForLastBank1Operation(EraseTimeout);
    509              
    510              /* Disable the MER Bit */
    511              FLASH->CR &= CR_MER_Reset;
    512            }    
    513            if(status == FLASH_COMPLETE)
    514            {
    515              /* if the previous operation is completed, proceed to erase all pages */
    516               FLASH->CR2 |= CR_MER_Set;
    517               FLASH->CR2 |= CR_STRT_Set;
    518              
    519              /* Wait for last operation to be completed */
    520              status = FLASH_WaitForLastBank2Operation(EraseTimeout);
    521              
    522              /* Disable the MER Bit */
    523              FLASH->CR2 &= CR_MER_Reset;
    524            }
    525          #else
    526            /* Wait for last operation to be completed */
    527            status = FLASH_WaitForLastOperation(EraseTimeout);
    528            if(status == FLASH_COMPLETE)
    529            {
    530              /* if the previous operation is completed, proceed to erase all pages */
    531               FLASH->CR |= CR_MER_Set;
    532               FLASH->CR |= CR_STRT_Set;
    533              
    534              /* Wait for last operation to be completed */
    535              status = FLASH_WaitForLastOperation(EraseTimeout);
    536          
    537              /* Disable the MER Bit */
    538              FLASH->CR &= CR_MER_Reset;
    539            }
    540          #endif /* STM32F10X_XL */
    541          
    542            /* Return the Erase Status */
    543            return status;
    544          }
    545          
    546          /**
    547            * @brief  Erases all Bank1 FLASH pages.
    548            * @note   This function can be used for all STM32F10x devices.
    549            *         - For STM32F10X_XL devices this function erases all Bank1 pages.
    550            *         - For all other devices it erases all Bank1 pages and it is equivalent 
    551            *           to FLASH_EraseAllPages function.
    552            * @param  None
    553            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    554            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
    555            */
    556          FLASH_Status FLASH_EraseAllBank1Pages(void)
    557          {
    558            FLASH_Status status = FLASH_COMPLETE;
    559            /* Wait for last operation to be completed */
    560            status = FLASH_WaitForLastBank1Operation(EraseTimeout);
    561            
    562            if(status == FLASH_COMPLETE)
    563            {
    564              /* if the previous operation is completed, proceed to erase all pages */
    565               FLASH->CR |= CR_MER_Set;
    566               FLASH->CR |= CR_STRT_Set;
    567              
    568              /* Wait for last operation to be completed */
    569              status = FLASH_WaitForLastBank1Operation(EraseTimeout);
    570              
    571              /* Disable the MER Bit */
    572              FLASH->CR &= CR_MER_Reset;
    573            }    
    574            /* Return the Erase Status */
    575            return status;
    576          }
    577          
    578          #ifdef STM32F10X_XL
    579          /**
    580            * @brief  Erases all Bank2 FLASH pages.
    581            * @note   This function can be used only for STM32F10x_XL density devices.
    582            * @param  None
    583            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    584            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
    585            */
    586          FLASH_Status FLASH_EraseAllBank2Pages(void)
    587          {
    588            FLASH_Status status = FLASH_COMPLETE;
    589            /* Wait for last operation to be completed */
    590            status = FLASH_WaitForLastBank2Operation(EraseTimeout);
    591            
    592            if(status == FLASH_COMPLETE)
    593            {
    594              /* if the previous operation is completed, proceed to erase all pages */
    595               FLASH->CR2 |= CR_MER_Set;
    596               FLASH->CR2 |= CR_STRT_Set;
    597              
    598              /* Wait for last operation to be completed */
    599              status = FLASH_WaitForLastBank2Operation(EraseTimeout);
    600          
    601              /* Disable the MER Bit */
    602              FLASH->CR2 &= CR_MER_Reset;
    603            }    
    604            /* Return the Erase Status */
    605            return status;
    606          }
    607          #endif /* STM32F10X_XL */
    608          
    609          /**
    610            * @brief  Erases the FLASH option bytes.
    611            * @note   This functions erases all option bytes except the Read protection (RDP). 
    612            * @note   This function can be used for all STM32F10x devices.
    613            * @param  None
    614            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    615            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
    616            */
    617          FLASH_Status FLASH_EraseOptionBytes(void)
    618          {
    619            uint16_t rdptmp = RDP_Key;
    620          
    621            FLASH_Status status = FLASH_COMPLETE;
    622          
    623            /* Get the actual read protection Option Byte value */ 
    624            if(FLASH_GetReadOutProtectionStatus() != RESET)
    625            {
    626              rdptmp = 0x00;  
    627            }
    628          
    629            /* Wait for last operation to be completed */
    630            status = FLASH_WaitForLastOperation(EraseTimeout);
    631            if(status == FLASH_COMPLETE)
    632            {
    633              /* Authorize the small information block programming */
    634              FLASH->OPTKEYR = FLASH_KEY1;
    635              FLASH->OPTKEYR = FLASH_KEY2;
    636              
    637              /* if the previous operation is completed, proceed to erase the option bytes */
    638              FLASH->CR |= CR_OPTER_Set;
    639              FLASH->CR |= CR_STRT_Set;
    640              /* Wait for last operation to be completed */
    641              status = FLASH_WaitForLastOperation(EraseTimeout);
    642              
    643              if(status == FLASH_COMPLETE)
    644              {
    645                /* if the erase operation is completed, disable the OPTER Bit */
    646                FLASH->CR &= CR_OPTER_Reset;
    647                 
    648                /* Enable the Option Bytes Programming operation */
    649                FLASH->CR |= CR_OPTPG_Set;
    650                /* Restore the last read protection Option Byte value */
    651                OB->RDP = (uint16_t)rdptmp; 
    652                /* Wait for last operation to be completed */
    653                status = FLASH_WaitForLastOperation(ProgramTimeout);
    654           
    655                if(status != FLASH_TIMEOUT)
    656                {
    657                  /* if the program operation is completed, disable the OPTPG Bit */
    658                  FLASH->CR &= CR_OPTPG_Reset;
    659                }
    660              }
    661              else
    662              {
    663                if (status != FLASH_TIMEOUT)
    664                {
    665                  /* Disable the OPTPG Bit */
    666                  FLASH->CR &= CR_OPTPG_Reset;
    667                }
    668              }  
    669            }
    670            /* Return the erase status */
    671            return status;
    672          }
    673          
    674          /**
    675            * @brief  Programs a word at a specified address.
    676            * @note   This function can be used for all STM32F10x devices.
    677            * @param  Address: specifies the address to be programmed.
    678            * @param  Data: specifies the data to be programmed.
    679            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    680            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT. 
    681            */
    682          FLASH_Status FLASH_ProgramWord(uint32_t Address, uint32_t Data)
    683          {
    684            FLASH_Status status = FLASH_COMPLETE;
    685            __IO uint32_t tmp = 0;
    686          
    687            /* Check the parameters */
    688            assert_param(IS_FLASH_ADDRESS(Address));
    689          
    690          #ifdef STM32F10X_XL
    691            if(Address < FLASH_BANK1_END_ADDRESS - 2)
    692            { 
    693              /* Wait for last operation to be completed */
    694              status = FLASH_WaitForLastBank1Operation(ProgramTimeout); 
    695              if(status == FLASH_COMPLETE)
    696              {
    697                /* if the previous operation is completed, proceed to program the new first 
    698                  half word */
    699                FLASH->CR |= CR_PG_Set;
    700            
    701                *(__IO uint16_t*)Address = (uint16_t)Data;
    702                /* Wait for last operation to be completed */
    703                status = FLASH_WaitForLastOperation(ProgramTimeout);
    704           
    705                if(status == FLASH_COMPLETE)
    706                {
    707                  /* if the previous operation is completed, proceed to program the new second 
    708                  half word */
    709                  tmp = Address + 2;
    710          
    711                  *(__IO uint16_t*) tmp = Data >> 16;
    712              
    713                  /* Wait for last operation to be completed */
    714                  status = FLASH_WaitForLastOperation(ProgramTimeout);
    715                  
    716                  /* Disable the PG Bit */
    717                  FLASH->CR &= CR_PG_Reset;
    718                }
    719                else
    720                {
    721                  /* Disable the PG Bit */
    722                  FLASH->CR &= CR_PG_Reset;
    723                 }
    724              }
    725            }
    726            else if(Address == (FLASH_BANK1_END_ADDRESS - 1))
    727            {
    728              /* Wait for last operation to be completed */
    729              status = FLASH_WaitForLastBank1Operation(ProgramTimeout);
    730          
    731              if(status == FLASH_COMPLETE)
    732              {
    733                /* if the previous operation is completed, proceed to program the new first 
    734                  half word */
    735                FLASH->CR |= CR_PG_Set;
    736            
    737                *(__IO uint16_t*)Address = (uint16_t)Data;
    738          
    739                /* Wait for last operation to be completed */
    740                status = FLASH_WaitForLastBank1Operation(ProgramTimeout);
    741                
    742          	  /* Disable the PG Bit */
    743                FLASH->CR &= CR_PG_Reset;
    744              }
    745              else
    746              {
    747                /* Disable the PG Bit */
    748                FLASH->CR &= CR_PG_Reset;
    749              }
    750          
    751              /* Wait for last operation to be completed */
    752              status = FLASH_WaitForLastBank2Operation(ProgramTimeout);
    753          
    754              if(status == FLASH_COMPLETE)
    755              {
    756                /* if the previous operation is completed, proceed to program the new second 
    757                half word */
    758                FLASH->CR2 |= CR_PG_Set;
    759                tmp = Address + 2;
    760          
    761                *(__IO uint16_t*) tmp = Data >> 16;
    762              
    763                /* Wait for last operation to be completed */
    764                status = FLASH_WaitForLastBank2Operation(ProgramTimeout);
    765                  
    766                /* Disable the PG Bit */
    767                FLASH->CR2 &= CR_PG_Reset;
    768              }
    769              else
    770              {
    771                /* Disable the PG Bit */
    772                FLASH->CR2 &= CR_PG_Reset;
    773              }
    774            }
    775            else
    776            {
    777              /* Wait for last operation to be completed */
    778              status = FLASH_WaitForLastBank2Operation(ProgramTimeout);
    779          
    780              if(status == FLASH_COMPLETE)
    781              {
    782                /* if the previous operation is completed, proceed to program the new first 
    783                  half word */
    784                FLASH->CR2 |= CR_PG_Set;
    785            
    786                *(__IO uint16_t*)Address = (uint16_t)Data;
    787                /* Wait for last operation to be completed */
    788                status = FLASH_WaitForLastBank2Operation(ProgramTimeout);
    789           
    790                if(status == FLASH_COMPLETE)
    791                {
    792                  /* if the previous operation is completed, proceed to program the new second 
    793                  half word */
    794                  tmp = Address + 2;
    795          
    796                  *(__IO uint16_t*) tmp = Data >> 16;
    797              
    798                  /* Wait for last operation to be completed */
    799                  status = FLASH_WaitForLastBank2Operation(ProgramTimeout);
    800                  
    801                  /* Disable the PG Bit */
    802                  FLASH->CR2 &= CR_PG_Reset;
    803                }
    804                else
    805                {
    806                  /* Disable the PG Bit */
    807                  FLASH->CR2 &= CR_PG_Reset;
    808                }
    809              }
    810            }
    811          #else
    812            /* Wait for last operation to be completed */
    813            status = FLASH_WaitForLastOperation(ProgramTimeout);
    814            
    815            if(status == FLASH_COMPLETE)
    816            {
    817              /* if the previous operation is completed, proceed to program the new first 
    818              half word */
    819              FLASH->CR |= CR_PG_Set;
    820            
    821              *(__IO uint16_t*)Address = (uint16_t)Data;
    822              /* Wait for last operation to be completed */
    823              status = FLASH_WaitForLastOperation(ProgramTimeout);
    824           
    825              if(status == FLASH_COMPLETE)
    826              {
    827                /* if the previous operation is completed, proceed to program the new second 
    828                half word */
    829                tmp = Address + 2;
    830          
    831                *(__IO uint16_t*) tmp = Data >> 16;
    832              
    833                /* Wait for last operation to be completed */
    834                status = FLASH_WaitForLastOperation(ProgramTimeout);
    835                  
    836                /* Disable the PG Bit */
    837                FLASH->CR &= CR_PG_Reset;
    838              }
    839              else
    840              {
    841                /* Disable the PG Bit */
    842                FLASH->CR &= CR_PG_Reset;
    843              }
    844            }         
    845          #endif /* STM32F10X_XL */
    846             
    847            /* Return the Program Status */
    848            return status;
    849          }
    850          
    851          /**
    852            * @brief  Programs a half word at a specified address.
    853            * @note   This function can be used for all STM32F10x devices.
    854            * @param  Address: specifies the address to be programmed.
    855            * @param  Data: specifies the data to be programmed.
    856            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    857            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT. 
    858            */
    859          FLASH_Status FLASH_ProgramHalfWord(uint32_t Address, uint16_t Data)
    860          {
    861            FLASH_Status status = FLASH_COMPLETE;
    862            /* Check the parameters */
    863            assert_param(IS_FLASH_ADDRESS(Address));
    864          
    865          #ifdef STM32F10X_XL
    866            /* Wait for last operation to be completed */
    867            status = FLASH_WaitForLastOperation(ProgramTimeout);
    868            
    869            if(Address < FLASH_BANK1_END_ADDRESS)
    870            {
    871              if(status == FLASH_COMPLETE)
    872              {
    873                /* if the previous operation is completed, proceed to program the new data */
    874                FLASH->CR |= CR_PG_Set;
    875            
    876                *(__IO uint16_t*)Address = Data;
    877                /* Wait for last operation to be completed */
    878                status = FLASH_WaitForLastBank1Operation(ProgramTimeout);
    879          
    880                /* Disable the PG Bit */
    881                FLASH->CR &= CR_PG_Reset;
    882              }
    883            }
    884            else
    885            {
    886              if(status == FLASH_COMPLETE)
    887              {
    888                /* if the previous operation is completed, proceed to program the new data */
    889                FLASH->CR2 |= CR_PG_Set;
    890            
    891                *(__IO uint16_t*)Address = Data;
    892                /* Wait for last operation to be completed */
    893                status = FLASH_WaitForLastBank2Operation(ProgramTimeout);
    894          
    895                /* Disable the PG Bit */
    896                FLASH->CR2 &= CR_PG_Reset;
    897              }
    898            }
    899          #else
    900            /* Wait for last operation to be completed */
    901            status = FLASH_WaitForLastOperation(ProgramTimeout);
    902            
    903            if(status == FLASH_COMPLETE)
    904            {
    905              /* if the previous operation is completed, proceed to program the new data */
    906              FLASH->CR |= CR_PG_Set;
    907            
    908              *(__IO uint16_t*)Address = Data;
    909              /* Wait for last operation to be completed */
    910              status = FLASH_WaitForLastOperation(ProgramTimeout);
    911              
    912              /* Disable the PG Bit */
    913              FLASH->CR &= CR_PG_Reset;
    914            } 
    915          #endif  /* STM32F10X_XL */
    916            
    917            /* Return the Program Status */
    918            return status;
    919          }
    920          
    921          /**
    922            * @brief  Programs a half word at a specified Option Byte Data address.
    923            * @note   This function can be used for all STM32F10x devices.
    924            * @param  Address: specifies the address to be programmed.
    925            *   This parameter can be 0x1FFFF804 or 0x1FFFF806. 
    926            * @param  Data: specifies the data to be programmed.
    927            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    928            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT. 
    929            */
    930          FLASH_Status FLASH_ProgramOptionByteData(uint32_t Address, uint8_t Data)
    931          {
    932            FLASH_Status status = FLASH_COMPLETE;
    933            /* Check the parameters */
    934            assert_param(IS_OB_DATA_ADDRESS(Address));
    935            status = FLASH_WaitForLastOperation(ProgramTimeout);
    936          
    937            if(status == FLASH_COMPLETE)
    938            {
    939              /* Authorize the small information block programming */
    940              FLASH->OPTKEYR = FLASH_KEY1;
    941              FLASH->OPTKEYR = FLASH_KEY2;
    942              /* Enables the Option Bytes Programming operation */
    943              FLASH->CR |= CR_OPTPG_Set; 
    944              *(__IO uint16_t*)Address = Data;
    945              
    946              /* Wait for last operation to be completed */
    947              status = FLASH_WaitForLastOperation(ProgramTimeout);
    948              if(status != FLASH_TIMEOUT)
    949              {
    950                /* if the program operation is completed, disable the OPTPG Bit */
    951                FLASH->CR &= CR_OPTPG_Reset;
    952              }
    953            }
    954            /* Return the Option Byte Data Program Status */
    955            return status;
    956          }
    957          
    958          /**
    959            * @brief  Write protects the desired pages
    960            * @note   This function can be used for all STM32F10x devices.
    961            * @param  FLASH_Pages: specifies the address of the pages to be write protected.
    962            *   This parameter can be:
    963            *     @arg For @b STM32_Low-density_devices: value between FLASH_WRProt_Pages0to3 and FLASH_WRProt_Pages28to31  
    964            *     @arg For @b STM32_Medium-density_devices: value between FLASH_WRProt_Pages0to3
    965            *       and FLASH_WRProt_Pages124to127
    966            *     @arg For @b STM32_High-density_devices: value between FLASH_WRProt_Pages0to1 and
    967            *       FLASH_WRProt_Pages60to61 or FLASH_WRProt_Pages62to255
    968            *     @arg For @b STM32_Connectivity_line_devices: value between FLASH_WRProt_Pages0to1 and
    969            *       FLASH_WRProt_Pages60to61 or FLASH_WRProt_Pages62to127    
    970            *     @arg For @b STM32_XL-density_devices: value between FLASH_WRProt_Pages0to1 and
    971            *       FLASH_WRProt_Pages60to61 or FLASH_WRProt_Pages62to511
    972            *     @arg FLASH_WRProt_AllPages
    973            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
    974            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
    975            */
    976          FLASH_Status FLASH_EnableWriteProtection(uint32_t FLASH_Pages)
    977          {
    978            uint16_t WRP0_Data = 0xFFFF, WRP1_Data = 0xFFFF, WRP2_Data = 0xFFFF, WRP3_Data = 0xFFFF;
    979            
    980            FLASH_Status status = FLASH_COMPLETE;
    981            
    982            /* Check the parameters */
    983            assert_param(IS_FLASH_WRPROT_PAGE(FLASH_Pages));
    984            
    985            FLASH_Pages = (uint32_t)(~FLASH_Pages);
    986            WRP0_Data = (uint16_t)(FLASH_Pages & WRP0_Mask);
    987            WRP1_Data = (uint16_t)((FLASH_Pages & WRP1_Mask) >> 8);
    988            WRP2_Data = (uint16_t)((FLASH_Pages & WRP2_Mask) >> 16);
    989            WRP3_Data = (uint16_t)((FLASH_Pages & WRP3_Mask) >> 24);
    990            
    991            /* Wait for last operation to be completed */
    992            status = FLASH_WaitForLastOperation(ProgramTimeout);
    993            
    994            if(status == FLASH_COMPLETE)
    995            {
    996              /* Authorizes the small information block programming */
    997              FLASH->OPTKEYR = FLASH_KEY1;
    998              FLASH->OPTKEYR = FLASH_KEY2;
    999              FLASH->CR |= CR_OPTPG_Set;
   1000              if(WRP0_Data != 0xFF)
   1001              {
   1002                OB->WRP0 = WRP0_Data;
   1003                
   1004                /* Wait for last operation to be completed */
   1005                status = FLASH_WaitForLastOperation(ProgramTimeout);
   1006              }
   1007              if((status == FLASH_COMPLETE) && (WRP1_Data != 0xFF))
   1008              {
   1009                OB->WRP1 = WRP1_Data;
   1010                
   1011                /* Wait for last operation to be completed */
   1012                status = FLASH_WaitForLastOperation(ProgramTimeout);
   1013              }
   1014              if((status == FLASH_COMPLETE) && (WRP2_Data != 0xFF))
   1015              {
   1016                OB->WRP2 = WRP2_Data;
   1017                
   1018                /* Wait for last operation to be completed */
   1019                status = FLASH_WaitForLastOperation(ProgramTimeout);
   1020              }
   1021              
   1022              if((status == FLASH_COMPLETE)&& (WRP3_Data != 0xFF))
   1023              {
   1024                OB->WRP3 = WRP3_Data;
   1025               
   1026                /* Wait for last operation to be completed */
   1027                status = FLASH_WaitForLastOperation(ProgramTimeout);
   1028              }
   1029                    
   1030              if(status != FLASH_TIMEOUT)
   1031              {
   1032                /* if the program operation is completed, disable the OPTPG Bit */
   1033                FLASH->CR &= CR_OPTPG_Reset;
   1034              }
   1035            } 
   1036            /* Return the write protection operation Status */
   1037            return status;       
   1038          }
   1039          
   1040          /**
   1041            * @brief  Enables or disables the read out protection.
   1042            * @note   If the user has already programmed the other option bytes before calling 
   1043            *   this function, he must re-program them since this function erases all option bytes.
   1044            * @note   This function can be used for all STM32F10x devices.
   1045            * @param  Newstate: new state of the ReadOut Protection.
   1046            *   This parameter can be: ENABLE or DISABLE.
   1047            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
   1048            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
   1049            */
   1050          FLASH_Status FLASH_ReadOutProtection(FunctionalState NewState)
   1051          {
   1052            FLASH_Status status = FLASH_COMPLETE;
   1053            /* Check the parameters */
   1054            assert_param(IS_FUNCTIONAL_STATE(NewState));
   1055            status = FLASH_WaitForLastOperation(EraseTimeout);
   1056            if(status == FLASH_COMPLETE)
   1057            {
   1058              /* Authorizes the small information block programming */
   1059              FLASH->OPTKEYR = FLASH_KEY1;
   1060              FLASH->OPTKEYR = FLASH_KEY2;
   1061              FLASH->CR |= CR_OPTER_Set;
   1062              FLASH->CR |= CR_STRT_Set;
   1063              /* Wait for last operation to be completed */
   1064              status = FLASH_WaitForLastOperation(EraseTimeout);
   1065              if(status == FLASH_COMPLETE)
   1066              {
   1067                /* if the erase operation is completed, disable the OPTER Bit */
   1068                FLASH->CR &= CR_OPTER_Reset;
   1069                /* Enable the Option Bytes Programming operation */
   1070                FLASH->CR |= CR_OPTPG_Set; 
   1071                if(NewState != DISABLE)
   1072                {
   1073                  OB->RDP = 0x00;
   1074                }
   1075                else
   1076                {
   1077                  OB->RDP = RDP_Key;  
   1078                }
   1079                /* Wait for last operation to be completed */
   1080                status = FLASH_WaitForLastOperation(EraseTimeout); 
   1081              
   1082                if(status != FLASH_TIMEOUT)
   1083                {
   1084                  /* if the program operation is completed, disable the OPTPG Bit */
   1085                  FLASH->CR &= CR_OPTPG_Reset;
   1086                }
   1087              }
   1088              else 
   1089              {
   1090                if(status != FLASH_TIMEOUT)
   1091                {
   1092                  /* Disable the OPTER Bit */
   1093                  FLASH->CR &= CR_OPTER_Reset;
   1094                }
   1095              }
   1096            }
   1097            /* Return the protection operation Status */
   1098            return status;       
   1099          }
   1100          
   1101          /**
   1102            * @brief  Programs the FLASH User Option Byte: IWDG_SW / RST_STOP / RST_STDBY.
   1103            * @note   This function can be used for all STM32F10x devices.
   1104            * @param  OB_IWDG: Selects the IWDG mode
   1105            *   This parameter can be one of the following values:
   1106            *     @arg OB_IWDG_SW: Software IWDG selected
   1107            *     @arg OB_IWDG_HW: Hardware IWDG selected
   1108            * @param  OB_STOP: Reset event when entering STOP mode.
   1109            *   This parameter can be one of the following values:
   1110            *     @arg OB_STOP_NoRST: No reset generated when entering in STOP
   1111            *     @arg OB_STOP_RST: Reset generated when entering in STOP
   1112            * @param  OB_STDBY: Reset event when entering Standby mode.
   1113            *   This parameter can be one of the following values:
   1114            *     @arg OB_STDBY_NoRST: No reset generated when entering in STANDBY
   1115            *     @arg OB_STDBY_RST: Reset generated when entering in STANDBY
   1116            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG, 
   1117            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
   1118            */
   1119          FLASH_Status FLASH_UserOptionByteConfig(uint16_t OB_IWDG, uint16_t OB_STOP, uint16_t OB_STDBY)
   1120          {
   1121            FLASH_Status status = FLASH_COMPLETE; 
   1122          
   1123            /* Check the parameters */
   1124            assert_param(IS_OB_IWDG_SOURCE(OB_IWDG));
   1125            assert_param(IS_OB_STOP_SOURCE(OB_STOP));
   1126            assert_param(IS_OB_STDBY_SOURCE(OB_STDBY));
   1127          
   1128            /* Authorize the small information block programming */
   1129            FLASH->OPTKEYR = FLASH_KEY1;
   1130            FLASH->OPTKEYR = FLASH_KEY2;
   1131            
   1132            /* Wait for last operation to be completed */
   1133            status = FLASH_WaitForLastOperation(ProgramTimeout);
   1134            
   1135            if(status == FLASH_COMPLETE)
   1136            {  
   1137              /* Enable the Option Bytes Programming operation */
   1138              FLASH->CR |= CR_OPTPG_Set; 
   1139                     
   1140              OB->USER = OB_IWDG | (uint16_t)(OB_STOP | (uint16_t)(OB_STDBY | ((uint16_t)0xF8))); 
   1141            
   1142              /* Wait for last operation to be completed */
   1143              status = FLASH_WaitForLastOperation(ProgramTimeout);
   1144              if(status != FLASH_TIMEOUT)
   1145              {
   1146                /* if the program operation is completed, disable the OPTPG Bit */
   1147                FLASH->CR &= CR_OPTPG_Reset;
   1148              }
   1149            }    
   1150            /* Return the Option Byte program Status */
   1151            return status;
   1152          }
   1153          
   1154          #ifdef STM32F10X_XL
   1155          /**
   1156            * @brief  Configures to boot from Bank1 or Bank2.  
   1157            * @note   This function can be used only for STM32F10x_XL density devices.
   1158            * @param  FLASH_BOOT: select the FLASH Bank to boot from.
   1159            *   This parameter can be one of the following values:
   1160            *     @arg FLASH_BOOT_Bank1: At startup, if boot pins are set in boot from user Flash
   1161            *        position and this parameter is selected the device will boot from Bank1(Default).
   1162            *     @arg FLASH_BOOT_Bank2: At startup, if boot pins are set in boot from user Flash
   1163            *        position and this parameter is selected the device will boot from Bank2 or Bank1,
   1164            *        depending on the activation of the bank. The active banks are checked in
   1165            *        the following order: Bank2, followed by Bank1.
   1166            *        The active bank is recognized by the value programmed at the base address
   1167            *        of the respective bank (corresponding to the initial stack pointer value
   1168            *        in the interrupt vector table).
   1169            *        For more information, please refer to AN2606 from www.st.com.    
   1170            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG, 
   1171            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
   1172            */
   1173          FLASH_Status FLASH_BootConfig(uint16_t FLASH_BOOT)
   1174          { 
   1175            FLASH_Status status = FLASH_COMPLETE; 
   1176            assert_param(IS_FLASH_BOOT(FLASH_BOOT));
   1177            /* Authorize the small information block programming */
   1178            FLASH->OPTKEYR = FLASH_KEY1;
   1179            FLASH->OPTKEYR = FLASH_KEY2;
   1180            
   1181            /* Wait for last operation to be completed */
   1182            status = FLASH_WaitForLastOperation(ProgramTimeout);
   1183            
   1184            if(status == FLASH_COMPLETE)
   1185            {  
   1186              /* Enable the Option Bytes Programming operation */
   1187              FLASH->CR |= CR_OPTPG_Set; 
   1188          
   1189              if(FLASH_BOOT == FLASH_BOOT_Bank1)
   1190              {
   1191                OB->USER |= OB_USER_BFB2;
   1192              }
   1193              else
   1194              {
   1195                OB->USER &= (uint16_t)(~(uint16_t)(OB_USER_BFB2));
   1196              }
   1197              /* Wait for last operation to be completed */
   1198              status = FLASH_WaitForLastOperation(ProgramTimeout);
   1199              if(status != FLASH_TIMEOUT)
   1200              {
   1201                /* if the program operation is completed, disable the OPTPG Bit */
   1202                FLASH->CR &= CR_OPTPG_Reset;
   1203              }
   1204            }    
   1205            /* Return the Option Byte program Status */
   1206            return status;
   1207          }
   1208          #endif /* STM32F10X_XL */
   1209          
   1210          /**
   1211            * @brief  Returns the FLASH User Option Bytes values.
   1212            * @note   This function can be used for all STM32F10x devices.
   1213            * @param  None
   1214            * @retval The FLASH User Option Bytes values:IWDG_SW(Bit0), RST_STOP(Bit1)
   1215            *         and RST_STDBY(Bit2).
   1216            */
   1217          uint32_t FLASH_GetUserOptionByte(void)
   1218          {
   1219            /* Return the User Option Byte */
   1220            return (uint32_t)(FLASH->OBR >> 2);
   1221          }
   1222          
   1223          /**
   1224            * @brief  Returns the FLASH Write Protection Option Bytes Register value.
   1225            * @note   This function can be used for all STM32F10x devices.
   1226            * @param  None
   1227            * @retval The FLASH Write Protection  Option Bytes Register value
   1228            */
   1229          uint32_t FLASH_GetWriteProtectionOptionByte(void)
   1230          {
   1231            /* Return the Flash write protection Register value */
   1232            return (uint32_t)(FLASH->WRPR);
   1233          }
   1234          
   1235          /**
   1236            * @brief  Checks whether the FLASH Read Out Protection Status is set or not.
   1237            * @note   This function can be used for all STM32F10x devices.
   1238            * @param  None
   1239            * @retval FLASH ReadOut Protection Status(SET or RESET)
   1240            */
   1241          FlagStatus FLASH_GetReadOutProtectionStatus(void)
   1242          {
   1243            FlagStatus readoutstatus = RESET;
   1244            if ((FLASH->OBR & RDPRT_Mask) != (uint32_t)RESET)
   1245            {
   1246              readoutstatus = SET;
   1247            }
   1248            else
   1249            {
   1250              readoutstatus = RESET;
   1251            }
   1252            return readoutstatus;
   1253          }
   1254          
   1255          /**
   1256            * @brief  Checks whether the FLASH Prefetch Buffer status is set or not.
   1257            * @note   This function can be used for all STM32F10x devices.
   1258            * @param  None
   1259            * @retval FLASH Prefetch Buffer Status (SET or RESET).
   1260            */
   1261          FlagStatus FLASH_GetPrefetchBufferStatus(void)
   1262          {
   1263            FlagStatus bitstatus = RESET;
   1264            
   1265            if ((FLASH->ACR & ACR_PRFTBS_Mask) != (uint32_t)RESET)
   1266            {
   1267              bitstatus = SET;
   1268            }
   1269            else
   1270            {
   1271              bitstatus = RESET;
   1272            }
   1273            /* Return the new state of FLASH Prefetch Buffer Status (SET or RESET) */
   1274            return bitstatus; 
   1275          }
   1276          
   1277          /**
   1278            * @brief  Enables or disables the specified FLASH interrupts.
   1279            * @note   This function can be used for all STM32F10x devices.
   1280            *         - For STM32F10X_XL devices, enables or disables the specified FLASH interrupts
   1281                        for Bank1 and Bank2.
   1282            *         - For other devices it enables or disables the specified FLASH interrupts for Bank1.
   1283            * @param  FLASH_IT: specifies the FLASH interrupt sources to be enabled or disabled.
   1284            *   This parameter can be any combination of the following values:
   1285            *     @arg FLASH_IT_ERROR: FLASH Error Interrupt
   1286            *     @arg FLASH_IT_EOP: FLASH end of operation Interrupt
   1287            * @param  NewState: new state of the specified Flash interrupts.
   1288            *   This parameter can be: ENABLE or DISABLE.      
   1289            * @retval None 
   1290            */
   1291          void FLASH_ITConfig(uint32_t FLASH_IT, FunctionalState NewState)
   1292          {
   1293          #ifdef STM32F10X_XL
   1294            /* Check the parameters */
   1295            assert_param(IS_FLASH_IT(FLASH_IT)); 
   1296            assert_param(IS_FUNCTIONAL_STATE(NewState));
   1297          
   1298            if((FLASH_IT & 0x80000000) != 0x0)
   1299            {
   1300              if(NewState != DISABLE)
   1301              {
   1302                /* Enable the interrupt sources */
   1303                FLASH->CR2 |= (FLASH_IT & 0x7FFFFFFF);
   1304              }
   1305              else
   1306              {
   1307                /* Disable the interrupt sources */
   1308                FLASH->CR2 &= ~(uint32_t)(FLASH_IT & 0x7FFFFFFF);
   1309              }
   1310            }
   1311            else
   1312            {
   1313              if(NewState != DISABLE)
   1314              {
   1315                /* Enable the interrupt sources */
   1316                FLASH->CR |= FLASH_IT;
   1317              }
   1318              else
   1319              {
   1320                /* Disable the interrupt sources */
   1321                FLASH->CR &= ~(uint32_t)FLASH_IT;
   1322              }
   1323            }
   1324          #else
   1325            /* Check the parameters */
   1326            assert_param(IS_FLASH_IT(FLASH_IT)); 
   1327            assert_param(IS_FUNCTIONAL_STATE(NewState));
   1328          
   1329            if(NewState != DISABLE)
   1330            {
   1331              /* Enable the interrupt sources */
   1332              FLASH->CR |= FLASH_IT;
   1333            }
   1334            else
   1335            {
   1336              /* Disable the interrupt sources */
   1337              FLASH->CR &= ~(uint32_t)FLASH_IT;
   1338            }
   1339          #endif /* STM32F10X_XL */
   1340          }
   1341          
   1342          /**
   1343            * @brief  Checks whether the specified FLASH flag is set or not.
   1344            * @note   This function can be used for all STM32F10x devices.
   1345            *         - For STM32F10X_XL devices, this function checks whether the specified 
   1346            *           Bank1 or Bank2 flag is set or not.
   1347            *         - For other devices, it checks whether the specified Bank1 flag is 
   1348            *           set or not.
   1349            * @param  FLASH_FLAG: specifies the FLASH flag to check.
   1350            *   This parameter can be one of the following values:
   1351            *     @arg FLASH_FLAG_BSY: FLASH Busy flag           
   1352            *     @arg FLASH_FLAG_PGERR: FLASH Program error flag       
   1353            *     @arg FLASH_FLAG_WRPRTERR: FLASH Write protected error flag      
   1354            *     @arg FLASH_FLAG_EOP: FLASH End of Operation flag           
   1355            *     @arg FLASH_FLAG_OPTERR:  FLASH Option Byte error flag     
   1356            * @retval The new state of FLASH_FLAG (SET or RESET).
   1357            */
   1358          FlagStatus FLASH_GetFlagStatus(uint32_t FLASH_FLAG)
   1359          {
   1360            FlagStatus bitstatus = RESET;
   1361          
   1362          #ifdef STM32F10X_XL
   1363            /* Check the parameters */
   1364            assert_param(IS_FLASH_GET_FLAG(FLASH_FLAG)) ;
   1365            if(FLASH_FLAG == FLASH_FLAG_OPTERR) 
   1366            {
   1367              if((FLASH->OBR & FLASH_FLAG_OPTERR) != (uint32_t)RESET)
   1368              {
   1369                bitstatus = SET;
   1370              }
   1371              else
   1372              {
   1373                bitstatus = RESET;
   1374              }
   1375            }
   1376            else
   1377            {
   1378              if((FLASH_FLAG & 0x80000000) != 0x0)
   1379              {
   1380                if((FLASH->SR2 & FLASH_FLAG) != (uint32_t)RESET)
   1381                {
   1382                  bitstatus = SET;
   1383                }
   1384                else
   1385                {
   1386                  bitstatus = RESET;
   1387                }
   1388              }
   1389              else
   1390              {
   1391                if((FLASH->SR & FLASH_FLAG) != (uint32_t)RESET)
   1392                {
   1393                  bitstatus = SET;
   1394                }
   1395                else
   1396                {
   1397                  bitstatus = RESET;
   1398                }
   1399              }
   1400            }
   1401          #else
   1402            /* Check the parameters */
   1403            assert_param(IS_FLASH_GET_FLAG(FLASH_FLAG)) ;
   1404            if(FLASH_FLAG == FLASH_FLAG_OPTERR) 
   1405            {
   1406              if((FLASH->OBR & FLASH_FLAG_OPTERR) != (uint32_t)RESET)
   1407              {
   1408                bitstatus = SET;
   1409              }
   1410              else
   1411              {
   1412                bitstatus = RESET;
   1413              }
   1414            }
   1415            else
   1416            {
   1417             if((FLASH->SR & FLASH_FLAG) != (uint32_t)RESET)
   1418              {
   1419                bitstatus = SET;
   1420              }
   1421              else
   1422              {
   1423                bitstatus = RESET;
   1424              }
   1425            }
   1426          #endif /* STM32F10X_XL */
   1427          
   1428            /* Return the new state of FLASH_FLAG (SET or RESET) */
   1429            return bitstatus;
   1430          }
   1431          
   1432          /**
   1433            * @brief  Clears the FLASH's pending flags.
   1434            * @note   This function can be used for all STM32F10x devices.
   1435            *         - For STM32F10X_XL devices, this function clears Bank1 or Bank2s pending flags
   1436            *         - For other devices, it clears Bank1s pending flags.
   1437            * @param  FLASH_FLAG: specifies the FLASH flags to clear.
   1438            *   This parameter can be any combination of the following values:         
   1439            *     @arg FLASH_FLAG_PGERR: FLASH Program error flag       
   1440            *     @arg FLASH_FLAG_WRPRTERR: FLASH Write protected error flag      
   1441            *     @arg FLASH_FLAG_EOP: FLASH End of Operation flag           
   1442            * @retval None
   1443            */
   1444          void FLASH_ClearFlag(uint32_t FLASH_FLAG)
   1445          {
   1446          #ifdef STM32F10X_XL
   1447            /* Check the parameters */
   1448            assert_param(IS_FLASH_CLEAR_FLAG(FLASH_FLAG)) ;
   1449          
   1450            if((FLASH_FLAG & 0x80000000) != 0x0)
   1451            {
   1452              /* Clear the flags */
   1453              FLASH->SR2 = FLASH_FLAG;
   1454            }
   1455            else
   1456            {
   1457              /* Clear the flags */
   1458              FLASH->SR = FLASH_FLAG;
   1459            }  
   1460          
   1461          #else
   1462            /* Check the parameters */
   1463            assert_param(IS_FLASH_CLEAR_FLAG(FLASH_FLAG)) ;
   1464            
   1465            /* Clear the flags */
   1466            FLASH->SR = FLASH_FLAG;
   1467          #endif /* STM32F10X_XL */
   1468          }
   1469          
   1470          /**
   1471            * @brief  Returns the FLASH Status.
   1472            * @note   This function can be used for all STM32F10x devices, it is equivalent
   1473            *         to FLASH_GetBank1Status function.
   1474            * @param  None
   1475            * @retval FLASH Status: The returned value can be: FLASH_BUSY, FLASH_ERROR_PG,
   1476            *         FLASH_ERROR_WRP or FLASH_COMPLETE
   1477            */
   1478          FLASH_Status FLASH_GetStatus(void)
   1479          {
   1480            FLASH_Status flashstatus = FLASH_COMPLETE;
   1481            
   1482            if((FLASH->SR & FLASH_FLAG_BSY) == FLASH_FLAG_BSY) 
   1483            {
   1484              flashstatus = FLASH_BUSY;
   1485            }
   1486            else 
   1487            {  
   1488              if((FLASH->SR & FLASH_FLAG_PGERR) != 0)
   1489              { 
   1490                flashstatus = FLASH_ERROR_PG;
   1491              }
   1492              else 
   1493              {
   1494                if((FLASH->SR & FLASH_FLAG_WRPRTERR) != 0 )
   1495                {
   1496                  flashstatus = FLASH_ERROR_WRP;
   1497                }
   1498                else
   1499                {
   1500                  flashstatus = FLASH_COMPLETE;
   1501                }
   1502              }
   1503            }
   1504            /* Return the Flash Status */
   1505            return flashstatus;
   1506          }
   1507          
   1508          /**
   1509            * @brief  Returns the FLASH Bank1 Status.
   1510            * @note   This function can be used for all STM32F10x devices, it is equivalent
   1511            *         to FLASH_GetStatus function.
   1512            * @param  None
   1513            * @retval FLASH Status: The returned value can be: FLASH_BUSY, FLASH_ERROR_PG,
   1514            *         FLASH_ERROR_WRP or FLASH_COMPLETE
   1515            */
   1516          FLASH_Status FLASH_GetBank1Status(void)
   1517          {
   1518            FLASH_Status flashstatus = FLASH_COMPLETE;
   1519            
   1520            if((FLASH->SR & FLASH_FLAG_BANK1_BSY) == FLASH_FLAG_BSY) 
   1521            {
   1522              flashstatus = FLASH_BUSY;
   1523            }
   1524            else 
   1525            {  
   1526              if((FLASH->SR & FLASH_FLAG_BANK1_PGERR) != 0)
   1527              { 
   1528                flashstatus = FLASH_ERROR_PG;
   1529              }
   1530              else 
   1531              {
   1532                if((FLASH->SR & FLASH_FLAG_BANK1_WRPRTERR) != 0 )
   1533                {
   1534                  flashstatus = FLASH_ERROR_WRP;
   1535                }
   1536                else
   1537                {
   1538                  flashstatus = FLASH_COMPLETE;
   1539                }
   1540              }
   1541            }
   1542            /* Return the Flash Status */
   1543            return flashstatus;
   1544          }
   1545          
   1546          #ifdef STM32F10X_XL
   1547          /**
   1548            * @brief  Returns the FLASH Bank2 Status.
   1549            * @note   This function can be used for STM32F10x_XL density devices.
   1550            * @param  None
   1551            * @retval FLASH Status: The returned value can be: FLASH_BUSY, FLASH_ERROR_PG,
   1552            *        FLASH_ERROR_WRP or FLASH_COMPLETE
   1553            */
   1554          FLASH_Status FLASH_GetBank2Status(void)
   1555          {
   1556            FLASH_Status flashstatus = FLASH_COMPLETE;
   1557            
   1558            if((FLASH->SR2 & (FLASH_FLAG_BANK2_BSY & 0x7FFFFFFF)) == (FLASH_FLAG_BANK2_BSY & 0x7FFFFFFF)) 
   1559            {
   1560              flashstatus = FLASH_BUSY;
   1561            }
   1562            else 
   1563            {  
   1564              if((FLASH->SR2 & (FLASH_FLAG_BANK2_PGERR & 0x7FFFFFFF)) != 0)
   1565              { 
   1566                flashstatus = FLASH_ERROR_PG;
   1567              }
   1568              else 
   1569              {
   1570                if((FLASH->SR2 & (FLASH_FLAG_BANK2_WRPRTERR & 0x7FFFFFFF)) != 0 )
   1571                {
   1572                  flashstatus = FLASH_ERROR_WRP;
   1573                }
   1574                else
   1575                {
   1576                  flashstatus = FLASH_COMPLETE;
   1577                }
   1578              }
   1579            }
   1580            /* Return the Flash Status */
   1581            return flashstatus;
   1582          }
   1583          #endif /* STM32F10X_XL */
   1584          /**
   1585            * @brief  Waits for a Flash operation to complete or a TIMEOUT to occur.
   1586            * @note   This function can be used for all STM32F10x devices, 
   1587            *         it is equivalent to FLASH_WaitForLastBank1Operation.
   1588            *         - For STM32F10X_XL devices this function waits for a Bank1 Flash operation
   1589            *           to complete or a TIMEOUT to occur.
   1590            *         - For all other devices it waits for a Flash operation to complete 
   1591            *           or a TIMEOUT to occur.
   1592            * @param  Timeout: FLASH programming Timeout
   1593            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
   1594            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
   1595            */
   1596          FLASH_Status FLASH_WaitForLastOperation(uint32_t Timeout)
   1597          { 
   1598            FLASH_Status status = FLASH_COMPLETE;
   1599             
   1600            /* Check for the Flash Status */
   1601            status = FLASH_GetBank1Status();
   1602            /* Wait for a Flash operation to complete or a TIMEOUT to occur */
   1603            while((status == FLASH_BUSY) && (Timeout != 0x00))
   1604            {
   1605              status = FLASH_GetBank1Status();
   1606              Timeout--;
   1607            }
   1608            if(Timeout == 0x00 )
   1609            {
   1610              status = FLASH_TIMEOUT;
   1611            }
   1612            /* Return the operation status */
   1613            return status;
   1614          }
   1615          
   1616          /**
   1617            * @brief  Waits for a Flash operation on Bank1 to complete or a TIMEOUT to occur.
   1618            * @note   This function can be used for all STM32F10x devices, 
   1619            *         it is equivalent to FLASH_WaitForLastOperation.
   1620            * @param  Timeout: FLASH programming Timeout
   1621            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
   1622            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
   1623            */
   1624          FLASH_Status FLASH_WaitForLastBank1Operation(uint32_t Timeout)
   1625          { 
   1626            FLASH_Status status = FLASH_COMPLETE;
   1627             
   1628            /* Check for the Flash Status */
   1629            status = FLASH_GetBank1Status();
   1630            /* Wait for a Flash operation to complete or a TIMEOUT to occur */
   1631            while((status == FLASH_FLAG_BANK1_BSY) && (Timeout != 0x00))
   1632            {
   1633              status = FLASH_GetBank1Status();
   1634              Timeout--;
   1635            }
   1636            if(Timeout == 0x00 )
   1637            {
   1638              status = FLASH_TIMEOUT;
   1639            }
   1640            /* Return the operation status */
   1641            return status;
   1642          }
   1643          
   1644          #ifdef STM32F10X_XL
   1645          /**
   1646            * @brief  Waits for a Flash operation on Bank2 to complete or a TIMEOUT to occur.
   1647            * @note   This function can be used only for STM32F10x_XL density devices.
   1648            * @param  Timeout: FLASH programming Timeout
   1649            * @retval FLASH Status: The returned value can be: FLASH_ERROR_PG,
   1650            *         FLASH_ERROR_WRP, FLASH_COMPLETE or FLASH_TIMEOUT.
   1651            */
   1652          FLASH_Status FLASH_WaitForLastBank2Operation(uint32_t Timeout)
   1653          { 
   1654            FLASH_Status status = FLASH_COMPLETE;
   1655             
   1656            /* Check for the Flash Status */
   1657            status = FLASH_GetBank2Status();
   1658            /* Wait for a Flash operation to complete or a TIMEOUT to occur */
   1659            while((status == (FLASH_FLAG_BANK2_BSY & 0x7FFFFFFF)) && (Timeout != 0x00))
   1660            {
   1661              status = FLASH_GetBank2Status();
   1662              Timeout--;
   1663            }
   1664            if(Timeout == 0x00 )
   1665            {
   1666              status = FLASH_TIMEOUT;
   1667            }
   1668            /* Return the operation status */
   1669            return status;
   1670          }
   1671          #endif /* STM32F10X_XL */
   1672          
   1673          /**
   1674            * @}
   1675            */
   1676          
   1677          /**
   1678            * @}
   1679            */
   1680          
   1681          /**
   1682            * @}
   1683            */
   1684          
   1685          /************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   FLASH_ClearFlag
      32   FLASH_EnableWriteProtection
        32   -> FLASH_WaitForLastOperation
       8   FLASH_EraseAllBank1Pages
         8   -> FLASH_WaitForLastBank1Operation
       8   FLASH_EraseAllPages
         8   -> FLASH_WaitForLastOperation
      16   FLASH_EraseOptionBytes
        16   -> FLASH_WaitForLastOperation
      16   FLASH_ErasePage
        16   -> FLASH_WaitForLastOperation
       0   FLASH_GetBank1Status
       0   FLASH_GetFlagStatus
       0   FLASH_GetPrefetchBufferStatus
       0   FLASH_GetReadOutProtectionStatus
       0   FLASH_GetStatus
       0   FLASH_GetUserOptionByte
       0   FLASH_GetWriteProtectionOptionByte
       0   FLASH_HalfCycleAccessCmd
       0   FLASH_ITConfig
       0   FLASH_Lock
       0   FLASH_LockBank1
       0   FLASH_PrefetchBufferCmd
      16   FLASH_ProgramHalfWord
        16   -> FLASH_WaitForLastOperation
      16   FLASH_ProgramOptionByteData
        16   -> FLASH_WaitForLastOperation
      24   FLASH_ProgramWord
        24   -> FLASH_WaitForLastOperation
      16   FLASH_ReadOutProtection
        16   -> FLASH_WaitForLastOperation
       0   FLASH_SetLatency
       0   FLASH_Unlock
       0   FLASH_UnlockBank1
      24   FLASH_UserOptionByteConfig
        24   -> FLASH_WaitForLastOperation
       0   FLASH_WaitForLastBank1Operation
         8   -> FLASH_GetBank1Status
       8   FLASH_WaitForLastOperation
         8   -> FLASH_GetBank1Status


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable21
       4  ??DataTable21_1
       4  ??DataTable21_10
       4  ??DataTable21_11
       4  ??DataTable21_2
       4  ??DataTable21_3
       4  ??DataTable21_4
       4  ??DataTable21_5
       4  ??DataTable21_6
       4  ??DataTable21_7
       4  ??DataTable21_8
       4  ??DataTable21_9
       6  ??Subroutine11_0
      18  ?Subroutine0
      14  ?Subroutine1
       8  ?Subroutine10
      10  ?Subroutine2
       6  ?Subroutine3
      26  ?Subroutine4
       8  ?Subroutine5
      12  ?Subroutine6
      12  ?Subroutine7
       8  ?Subroutine8
      16  ?Subroutine9
       6  FLASH_ClearFlag
     118  FLASH_EnableWriteProtection
      40  FLASH_EraseAllBank1Pages
      24  FLASH_EraseAllPages
      96  FLASH_EraseOptionBytes
      42  FLASH_ErasePage
      34  FLASH_GetBank1Status
      28  FLASH_GetFlagStatus
       6  FLASH_GetPrefetchBufferStatus
       8  FLASH_GetReadOutProtectionStatus
      34  FLASH_GetStatus
       8  FLASH_GetUserOptionByte
       6  FLASH_GetWriteProtectionOptionByte
      12  FLASH_HalfCycleAccessCmd
      18  FLASH_ITConfig
       2  FLASH_Lock
       2  FLASH_LockBank1
      10  FLASH_PrefetchBufferCmd
      42  FLASH_ProgramHalfWord
      54  FLASH_ProgramOptionByteData
      62  FLASH_ProgramWord
     102  FLASH_ReadOutProtection
      12  FLASH_SetLatency
       2  FLASH_Unlock
       2  FLASH_UnlockBank1
      54  FLASH_UserOptionByteConfig
       2  FLASH_WaitForLastBank1Operation
       4  FLASH_WaitForLastOperation

 
 1 022 bytes in section .text
 
 1 022 bytes of CODE memory

Errors: none
Warnings: none
